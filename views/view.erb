<%= partial(:'common/header') %>
<header>
  <h1>Phylogeny Explorer: <%= @collection.name %></h1>
  <a href="/" class="button print-phylogeny">Print</a>
</header>
<section class="results">
  <h2>Your Phylogeny</h2>
  <% if !@species.nil? %>
    <div id="phylogeny-canvas"></div>
  <% else %>
    <p>You didn't select any species</p>
  <% end %>
</section>
<div id="toolbar">
  <a href="/" class="home button">Start Over</a>
  <a href="#" class="button print-phylogeny">Print</a>
</div>
<div class="print-footer">
  <p>Generated by Phylogeny Explorer (http://www.phylogeny.biology.lsu.edu)</p>
</div>
<script>
  $(document).ready(function(){
    var speciesCount = <%= @species.length %>;
    if (speciesCount > 0) {
      $.ajax({
        type: 'POST',
        url: '/generate',
        data: { species: "<%= @species.map{ |s| s.id }.join(',') %>" },
        success: function(data) {
          var dataObject = { newick: data };
          Smits.PhyloCanvas.Render.Style.line["stroke"] = 'rgb(100,100,100)';
          Smits.PhyloCanvas.Render.Style.line["stroke-width"] = 2;
          Smits.PhyloCanvas.Render.Style.text["font-size"] = 18;
          var phylocanvas = new Smits.PhyloCanvas(
            dataObject,
            'phylogeny-canvas', 
            840, 500
          );
          /* Clean up the labels */
          var labels = document.getElementsByTagName('tspan');
          for (i = 0; i < labels.length; i++) {
            console.log(labels[i].textContent);
            labels[i].textContent = labels[i].textContent.replace('_', ' ');            
          }
        }
      });      
    }
    $('.print-phylogeny').click(function(event) {
      window.print();
      event.preventDefault();
    });
  });
</script>
<%= partial(:'common/footer') %>